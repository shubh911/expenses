<!-- src/app/expense-form/expense-form.component.html -->
<div class="container mx-auto p-4 max-w-7xl"> <!-- Increased max-width for 3-column layout -->
  <h2 class="text-3xl font-bold text-gray-800 dark:text-gray-100 mb-6 text-center">
    @if (isEditMode) {
      Edit Expense
    } @else {
      Add New Expense
    }
  </h2>

  @if (errorMessage) {
    <div class="bg-red-100 dark:bg-red-900 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-200 px-4 py-3 rounded relative mb-4" role="alert">
      <strong class="font-bold">Error!</strong>
      <span class="block sm:inline"> {{ errorMessage }}</span>
    </div>
  }

  @if (!isEditMode && expenseTags.length === 0) {
    <!-- Central message if no tags at all -->
    <div class="bg-white dark:bg-gray-800 shadow-lg rounded-lg p-6 text-center text-gray-600 dark:text-gray-400 mb-8">
      <p class="text-md">No recent expense patterns found to suggest. Add more expenses!</p>
    </div>
  }

  <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
    <!-- Left Tags Column -->
    @if (!isEditMode && leftTags.length > 0) {
      <div class="p-4"> <!-- Removed bg, shadow, rounded for transparent background -->
        <!-- Removed heading "Suggestions:" -->
        <div class="flex flex-wrap gap-2"> <!-- Changed to flex-wrap for dynamic width and wrapping -->
          @for (tag of leftTags; track $index) {
            <button (click)="fillFormWithTag(tag)" type="button"
                    class="bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 text-xs font-medium px-3 py-1 rounded-full hover:bg-blue-200 dark:hover:bg-blue-800 transition duration-200 ease-in-out">
              {{ tag.description }} ({{ tag.category }}) - {{ tag.amount | currency:'INR':'symbol':'1.2-2' }}
            </button>
          }
        </div>
      </div>
    } @else if (!isEditMode && expenseTags.length > 0 && leftTags.length === 0) {
      <!-- Placeholder for left column if all tags are on the right -->
      <div></div>
    }

    <!-- Form Column (Middle) -->
    <form [formGroup]="expenseForm" (ngSubmit)="onSubmit()" class="bg-white dark:bg-gray-800 shadow-lg rounded-lg p-6">
      <div class="mb-4">
        <label for="date" class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">Date:</label>
        <input type="date" id="date" formControlName="date"
               class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 dark:text-gray-200 dark:bg-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        @if (expenseForm.get('date')?.invalid && expenseForm.get('date')?.touched) {
          <div class="text-red-500 dark:text-red-400 text-xs mt-1">
            Date is required.
          </div>
        }
      </div>

      <div class="mb-4">
        <label for="amount" class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">Amount (â‚¹):</label>
        <input type="number" id="amount" formControlName="amount" step="0.01"
               class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 dark:text-gray-200 dark:bg-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        @if (expenseForm.get('amount')?.invalid && expenseForm.get('amount')?.touched) {
          <div class="text-red-500 dark:text-red-400 text-xs mt-1">
            Amount is required and must be a positive number.
          </div>
        }
      </div>

      <div class="mb-4">
        <label for="category" class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">Category:</label>
        <select id="category" formControlName="category"
                class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 dark:text-gray-200 dark:bg-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          <option value="" disabled>Select a category</option>
          @for (cat of categories; track cat) {
            <option [value]="cat">{{ cat }}</option>
          }
        </select>
        @if (expenseForm.get('category')?.invalid && expenseForm.get('category')?.touched) {
          <div class="text-red-500 dark:text-red-400 text-xs mt-1">
            Category is required.
          </div>
        }
      </div>

      <div class="mb-4">
        <label for="description" class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">Description:</label>
        <input type="text" id="description" formControlName="description"
               class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 dark:text-gray-200 dark:bg-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        @if (expenseForm.get('description')?.invalid && expenseForm.get('description')?.touched) {
          <div class="text-red-500 dark:text-red-400 text-xs mt-1">
            Description is required.
          </div>
        }
      </div>

      <div class="mb-6">
        <label for="notes" class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">Notes (Optional):</label>
        <textarea id="notes" formControlName="notes" rows="3"
                  class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 dark:text-gray-200 dark:bg-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
      </div>

      <div class="flex items-center justify-between">
        <button type="submit"
                [disabled]="!expenseForm.valid"
                class="bg-green-600 hover:bg-green-700 dark:bg-green-700 dark:hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg focus:outline-none focus:shadow-outline transition duration-300 ease-in-out transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed">
          @if (isEditMode) {
            Update Expense
          } @else {
            Add Expense
          }
        </button>
        <button type="button" routerLink="/expenses"
                class="bg-gray-500 hover:bg-gray-600 dark:bg-gray-700 dark:hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg focus:outline-none focus:shadow-outline transition duration-300 ease-in-out transform hover:scale-105">
          Cancel
        </button>
      </div>
    </form>

    <!-- Right Tags Column -->
    @if (!isEditMode && rightTags.length > 0) {
      <div class="p-4"> <!-- Removed bg, shadow, rounded for transparent background -->
        <!-- Removed heading "Suggestions:" -->
        <div class="flex flex-wrap gap-2"> <!-- Changed to flex-wrap for dynamic width and wrapping -->
          @for (tag of rightTags; track $index) {
            <button (click)="fillFormWithTag(tag)" type="button"
                    class="bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 text-xs font-medium px-3 py-1 rounded-full hover:bg-blue-200 dark:hover:bg-blue-800 transition duration-200 ease-in-out">
              {{ tag.description }} ({{ tag.category }}) - {{ tag.amount | currency:'INR':'symbol':'1.2-2' }}
            </button>
          }
        </div>
      </div>
    } @else if (!isEditMode && expenseTags.length > 0 && rightTags.length === 0) {
      <!-- Placeholder for right column if all tags are on the left -->
      <div></div>
    }
  </div>
</div>
